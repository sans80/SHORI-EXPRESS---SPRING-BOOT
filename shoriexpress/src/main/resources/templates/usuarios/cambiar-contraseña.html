<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cambiar Contrase√±a - Shori Express</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="icon" type="image/x-icon" th:href="@{/img/favicon.ico}">
    <style>
        body {
            background: #f8f9fa;
            align-items: flex-start;
            padding-top: 0;
        }

        .password-container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
        }
    </style>
</head>

<body>
    <div class="password-container">
        <!-- Navegaci√≥n -->
        <nav class="navbar">
            <div
                style="display: flex; justify-content: space-between; align-items: center; max-width: 500px; margin: 0 auto; padding: 0 20px;">
                <div style="display: flex; align-items: center;">
                    <div
                        style="width: 40px; height: 40px; background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 15px;">
                        SE
                    </div>
                    <h2 style="color: #333; margin: 0;">Cambiar Contrase√±a</h2>
                </div>

                <div class="nav-links">
                    <a th:href="@{/usuarios/perfil}">‚Üê Volver al Perfil</a>
                </div>
            </div>
        </nav>

        <!-- Mensajes -->
        <div th:if="${error}" class="alert alert-danger">
            <span th:text="${error}"></span>
        </div>

        <!-- Formulario de cambio de contrase√±a -->
        <div class="dashboard-card">
            <h3 style="color: #333; margin-bottom: 25px;">üîí Cambiar Contrase√±a</h3>

            <div
                style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 25px; border-left: 4px solid #2196f3;">
                <p style="margin: 0; color: #1976d2; font-size: 14px;">
                    <strong>Importante:</strong> Tu nueva contrase√±a debe tener al menos 6 caracteres.
                    Se recomienda usar una combinaci√≥n de letras, n√∫meros y s√≠mbolos para mayor seguridad.
                </p>
            </div>

            <form th:action="@{/usuarios/cambiar-contrase√±a}" method="post" id="changePasswordForm">
                <div class="form-group">
                    <label for="contrase√±aActual" class="form-label">Contrase√±a Actual *</label>
                    <input type="password" id="contrase√±aActual" name="contrase√±aActual" class="form-control"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>

                <div class="form-group">
                    <label for="nuevaContrase√±a" class="form-label">Nueva Contrase√±a *</label>
                    <input type="password" id="nuevaContrase√±a" name="nuevaContrase√±a" class="form-control"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                </div>

                <div class="form-group">
                    <label for="confirmarContrase√±a" class="form-label">Confirmar Nueva Contrase√±a *</label>
                    <input type="password" id="confirmarContrase√±a" name="confirmarContrase√±a" class="form-control"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" minlength="6" required>
                    <span id="passwordMatch" style="font-size: 14px; margin-top: 5px; display: block;"></span>
                </div>

                <div style="display: flex; gap: 15px; margin-top: 30px;">
                    <button type="submit" class="btn btn-primary" id="changePasswordBtn">
                        üîí Cambiar Contrase√±a
                    </button>
                    <a th:href="@{/usuarios/perfil}" class="btn btn-secondary">
                        ‚ùå Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const nuevaPassword = document.getElementById('nuevaContrase√±a');
            const confirmarPassword = document.getElementById('confirmarContrase√±a');
            const matchSpan = document.getElementById('passwordMatch');
            const form = document.getElementById('changePasswordForm');
            const submitBtn = document.getElementById('changePasswordBtn');

            function validarCoincidencia() {
                const nueva = nuevaPassword.value;
                const confirmar = confirmarPassword.value;

                if (confirmar.length === 0) {
                    matchSpan.textContent = '';
                    matchSpan.style.color = '';
                    return;
                }

                if (nueva === confirmar) {
                    matchSpan.textContent = '‚úì Las contrase√±as coinciden';
                    matchSpan.style.color = '#28a745';
                    confirmarPassword.classList.remove('error');
                } else {
                    matchSpan.textContent = '‚úó Las contrase√±as no coinciden';
                    matchSpan.style.color = '#dc3545';
                    confirmarPassword.classList.add('error');
                }
            }

            nuevaPassword.addEventListener('input', validarCoincidencia);
            confirmarPassword.addEventListener('input', validarCoincidencia);

            // Validar fortaleza de contrase√±a
            nuevaPassword.addEventListener('input', function () {
                const password = this.value;
                let existingStrength = this.parentNode.querySelector('.password-strength');

                if (existingStrength) {
                    existingStrength.remove();
                }

                if (password.length === 0) return;

                const strengthDiv = document.createElement('div');
                strengthDiv.className = 'password-strength';
                strengthDiv.style.fontSize = '12px';
                strengthDiv.style.marginTop = '5px';

                let strength = 0;
                let feedback = [];

                if (password.length >= 6) strength++;
                else feedback.push('Al menos 6 caracteres');

                if (/[A-Z]/.test(password)) strength++;
                else feedback.push('Una may√∫scula');

                if (/[a-z]/.test(password)) strength++;
                else feedback.push('Una min√∫scula');

                if (/[0-9]/.test(password)) strength++;
                else feedback.push('Un n√∫mero');

                if (/[^A-Za-z0-9]/.test(password)) strength++;
                else feedback.push('Un car√°cter especial');

                const colors = ['#dc3545', '#fd7e14', '#ffc107', '#28a745', '#198754'];
                const labels = ['Muy d√©bil', 'D√©bil', 'Regular', 'Fuerte', 'Muy fuerte'];

                strengthDiv.style.color = colors[strength - 1] || colors[0];
                strengthDiv.innerHTML = `
                    <div>Fortaleza: ${labels[strength - 1] || labels[0]}</div>
                    ${feedback.length > 0 ? `<div style="font-size: 11px; opacity: 0.8;">Falta: ${feedback.join(', ')}</div>` : ''}
                `;

                this.parentNode.appendChild(strengthDiv);
            });

            form.addEventListener('submit', function (e) {
                const nueva = nuevaPassword.value;
                const confirmar = confirmarPassword.value;

                if (nueva !== confirmar) {
                    e.preventDefault();
                    alert('Las contrase√±as no coinciden');
                    return;
                }

                if (nueva.length < 6) {
                    e.preventDefault();
                    alert('La nueva contrase√±a debe tener al menos 6 caracteres');
                    return;
                }

                // Mostrar estado de carga
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="spinner"></span> Cambiando contrase√±a...';
            });
        });
    </script>
</body>

</html>